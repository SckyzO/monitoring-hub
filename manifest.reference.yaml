# ==============================================================================
# MONITORING HUB - EXPORTER MANIFEST REFERENCE (v1.0)
# ==============================================================================
# This file serves as the Single Source of Truth for creating new exporters.
# It documents every available option, best practice, and default value.
#
# USAGE:
# 1. Copy this file to `exporters/<your_exporter>/manifest.yaml`
# 2. Fill in the required fields
# 3. Remove comments and unused optional sections
# ==============================================================================

# --- Identity -----------------------------------------------------------------
name: reference_exporter          # [REQUIRED] The technical name (slug) of the exporter (e.g., node_exporter)
description: "A reference..."     # [REQUIRED] A short, clear description displayed on the portal card
version: "1.0.0"                  # [REQUIRED] Semantic version. The Watcher automates updates to this field.

# --- Portal Metadata (UI v2) --------------------------------------------------
category: System                  # [OPTIONAL] Default: System.
# Options: System, Database, Web, Network, Storage, Messaging, Infrastructure
new: true                         # [OPTIONAL] Default: false. Shows a "New" badge on the portal.
updated: false                    # [OPTIONAL] Default: false. Shows an "Updated" badge on the portal.

# --- License Information ------------------------------------------------------
license: null                     # [OPTIONAL] SPDX license identifier (e.g., 'MIT', 'Apache-2.0', 'GPL-3.0')
# If not specified, the builder will automatically detect it from GitHub API
# for 'github' type upstreams. Falls back to 'Apache-2.0' if detection fails.
# Example values: MIT, Apache-2.0, BSD-3-Clause, GPL-3.0, MPL-2.0

# --- Upstream Source ----------------------------------------------------------
upstream:
  type: github                    # [REQUIRED] Supported values: 'github' or 'local'
  # [REQUIRED for github] The upstream GitHub repository.
  # Example: prometheus/node_exporter
  repo: owner/repo

  # [OPTIONAL] Release Strategy
  # strategy: latest_release      # Default. Uses the latest GitHub Release.

  # [OPTIONAL] Custom Archive Naming Pattern
  # If the upstream release artifacts don't follow standard naming conventions, define the pattern here.
  # Two formats supported:
  #
  # 1. String pattern (most common):
  # archive_name: "{name}-{clean_version}.linux-{arch}.tar.gz"
  #
  # 2. Dict format (per-architecture patterns):
  # archive_name:
  #   amd64: "project-v{clean_version}-x86_64-special.tar.gz"
  #   arm64: "project-v{clean_version}-arm64-custom.tar.gz"
  #
  # Available variables for string format or dict values:
  # - {name}: The exporter name defined above
  # - {version}: The raw version string (e.g., v1.0.0)
  # - {clean_version}: The version without 'v' prefix (e.g., 1.0.0)
  # - {arch}: Standard arch (amd64, arm64)
  # - {rpm_arch}: RPM convention (x86_64, aarch64)
  # - {deb_arch}: DEB convention (amd64, arm64) - same as {arch}
  # - {upstream_linux_arch}: Mixed convention (x86_64, arm64)
  #
  # Use dict format when upstream has completely different naming per arch.
  archive_name: null

# --- Alternative: Local Custom Binaries ---------------------------------------
# Use 'type: local' for custom or proprietary binaries not published on GitHub.
# upstream:
#   type: local
#
#   # Option 1: Direct binary file (most common)
#   local_binary: assets/my_exporter  # Path relative to this manifest
#
#   # Option 2: Compressed archive (.tar.gz or .gz)
#   # local_archive: assets/my_exporter.tar.gz
#
# IMPORTANT:
#   - Paths are relative to manifest location
#   - Store binaries in the exporter's assets/ directory
#   - Version must be updated manually (watcher skips local sources)
#   - No automatic updates for local sources

# --- Build Configuration ------------------------------------------------------
build:
  method: binary_repack           # [REQUIRED] Currently the only supported method.
  # Downloads the upstream binary and repackages it.

  binary_name: reference_exporter # [REQUIRED] The name of the binary file inside the upstream archive.
  # It will be installed to /usr/bin/<name>.

  # [OPTIONAL] Extra Binaries
  # If the archive contains other tools you want to install (e.g., CLI tools).
  # extra_binaries: [tool_cli, debug_tool]

  # [OPTIONAL] External Source Files
  # Use this to download configuration files, scripts, or assets not present in the release archive.
  # extra_sources:
  #   - url: https://raw.githubusercontent.com/owner/repo/main/config.example.yml
  #     filename: config.yml

  # [OPTIONAL] Architecture Restriction
  # If the upstream doesn't support all standard architectures (amd64, arm64).
  # archs: [amd64]

# --- Artifact: RPM Package ----------------------------------------------------
artifacts:
  rpm:
    enabled: true                 # [REQUIRED] Set to true to build RPMs.
    targets: [el8, el9, el10]     # [OPTIONAL] Default: [el8, el9, el10]. Target distributions.

    summary: "..."                # [OPTIONAL] Short summary for RPM metadata. Defaults to description.

    install_path: null            # [OPTIONAL] Custom installation directory (e.g., /usr/sbin).
    # Default: /usr/bin (%{_bindir}).

    # [OPTIONAL] System User
    # If set, the build process will automatically:
    # 1. Create this user/group on install.
    # 2. Assign ownership of defined directories to this user.
    system_user: my_service_user

    # [OPTIONAL] Runtime Dependencies
    # List of RPM packages required by the exporter.
    # dependencies: [openssl, shadow-utils]

    # [OPTIONAL] Extra Files Installation
    # Map local assets (from `exporters/<name>/assets/` or downloaded `extra_sources`) to destination paths.
    # extra_files:
    #   - source: assets/config.yml       # Path relative to exporter directory
    #     dest: /etc/reference/config.yml # Absolute path on target system
    #     mode: "0640"                    # Default: 0644
    #     config: true                    # Default: false. Marks as %config(noreplace) to preserve user changes.

    # [OPTIONAL] Directory Creation
    # Ensure specific directories exist with correct permissions.
    # directories:
    #   - path: /var/lib/reference_exporter
    #     owner: my_service_user      # Default: root (or system_user if defined)
    #     group: my_service_user      # Default: root (or system_user if defined)
    #     mode: "0755"                # Default: 0755

    # [OPTIONAL] Modern Systemd Management
    systemd:
      enabled: true               # Set to true to generate and install a systemd service.
      arguments: []               # [OPTIONAL] List of CLI arguments for ExecStart.
      after: [network.target]     # [OPTIONAL] Units to start after.
      restart: on-failure         # [OPTIONAL] Restart policy.
      type: simple                # [OPTIONAL] Service type.

  # --- Artifact: DEB Package --------------------------------------------------
  deb:
    enabled: true                 # [REQUIRED] Set to true to build DEB packages.
    targets:                      # [REQUIRED] Distribution target for build.
      - debian-12                 # NOTE: Single universal DEB built on Debian 12 (Bookworm).
                                  # This package is compatible with all modern Debian/Ubuntu distributions:
                                  # - Ubuntu 20.04+, 22.04, 24.04+ (Focal, Jammy, Noble+)
                                  # - Debian 11+, 12, 13+ (Bullseye, Bookworm, Trixie+)
                                  #
                                  # For binary_repack exporters (Go static binaries), there is no
                                  # technical difference between distributions. Building on Debian 12
                                  # provides maximum compatibility while minimizing build time and
                                  # avoiding filename collisions on GitHub Releases.

    summary: "..."                # [OPTIONAL] Short summary for DEB metadata. Defaults to description.

    # [OPTIONAL] Debian Control Fields
    section: net                  # [OPTIONAL] Default: net. Package category (admin, utils, net, devel, etc.)
    # [OPTIONAL] Default: optional. Package priority (required, important, standard,
    # optional, extra)
    priority: optional

    # [OPTIONAL] System User
    # If set, the build process will automatically:
    # 1. Create this user/group on install (via postinst script).
    # 2. Assign ownership of defined directories to this user.
    # system_user: my_service_user

    # [OPTIONAL] Runtime Dependencies
    # List of DEB packages required by the exporter.
    # dependencies: [openssl, adduser]

    # [OPTIONAL] Extra Files Installation
    # Map local assets (from `exporters/<name>/assets/` or downloaded `extra_sources`) to destination paths.
    # extra_files:
    #   - source: assets/config.yml       # Path relative to exporter directory
    #     dest: /etc/reference/config.yml # Absolute path on target system
    #     mode: "0640"                    # Default: 0644

    # [OPTIONAL] Directory Creation
    # Ensure specific directories exist with correct permissions.
    # directories:
    #   - path: /var/lib/reference_exporter
    #     owner: my_service_user      # Default: root (or system_user if defined)
    #     group: my_service_user      # Default: root (or system_user if defined)
    #     mode: "0755"                # Default: 0755

    # [OPTIONAL] Modern Systemd Management
    systemd:
      enabled: true               # Set to true to generate and install a systemd service.
      arguments: []               # [OPTIONAL] List of CLI arguments for ExecStart.
      after: [network.target]     # [OPTIONAL] Units to start after.
      restart: on-failure         # [OPTIONAL] Restart policy.
      type: simple                # [OPTIONAL] Service type.

  # --- Artifact: Docker Image -------------------------------------------------
  docker:
    enabled: true                 # [REQUIRED] Set to true to build OCI images.

    # [OPTIONAL] Base Image
    # We strongly recommend keeping the default for security and consistency.
    # base_image: registry.access.redhat.com/ubi9/ubi-minimal

    # [OPTIONAL] Entrypoint & Command
    # Defines how the container starts.
    entrypoint: ["/usr/bin/reference_exporter"]
    # cmd: ["--config.file=/etc/reference/config.yml"]

    # [REQUIRED] Automated Validation (Local Tests)
    # These tests run immediately after build to ensure the image is functional.
    validation:
      enabled: true               # Master switch for validation.

      # [OPTIONAL] Port Check
      # Starts the container and waits for HTTP 200 OK on /metrics (or standard prometheus endpoints).
      port: 9100

      # [OPTIONAL] Command Check
      # Runs a specific command inside the container and expects exit code 0.
      # Useful for checking version output.
      # command: "--version"

      # [OPTIONAL] Container Arguments
      # Arguments passed to the container when running Port Check.
      # Useful if the exporter requires specific flags to start its web server.
      # args: "-varz http://localhost:8222"
