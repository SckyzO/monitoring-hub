# Template RPM par d√©faut
%define debug_package %{nil}

Name:           {{ name }}
Version:        {{ version }}
Release:        1%{?dist}
Summary:        {{ artifacts.rpm.summary }}

License:        Apache-2.0
URL:            https://github.com/{{ upstream.repo }}
Source0:        https://github.com/{{ upstream.repo }}/releases/download/v{{ version }}/{{ name }}-{{ version }}.linux-amd64.tar.gz

BuildArch:      x86_64

%description
{{ description }}

%prep
%setup -q -n {{ name }}-{{ version }}.linux-amd64

%build
# Nothing to build, binary repack

%install
rm -rf $RPM_BUILD_ROOT
install -D -m 0755 {{ build.binary_name }} $RPM_BUILD_ROOT%{_bindir}/{{ name }}

{% if artifacts.rpm.service_file %}
# Install systemd service
mkdir -p $RPM_BUILD_ROOT%{_unitdir}
cat <<EOF > $RPM_BUILD_ROOT%{_unitdir}/{{ name }}.service
[Unit]
Description={{ description }}
After=network.target

[Service]
Type=simple
User=prometheus
ExecStart=%{_bindir}/{{ name }}
Restart=on-failure

[Install]
WantedBy=multi-user.target
EOF
{% endif %}

%files
%{_bindir}/{{ name }}
{% if artifacts.rpm.service_file %}
%{_unitdir}/{{ name }}.service
{% endif %}

%changelog
* Wed Dec 31 2025 Monitoring Hub <bot@monitoring-hub.local> - {{ version }}-1
- Automated build
